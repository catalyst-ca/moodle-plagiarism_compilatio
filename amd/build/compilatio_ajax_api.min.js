define(["jquery"],function(c){function a(){c(".cmp-action-btn").each(function(){c(this).attr("disabled","disabled"),c(this).addClass("disabled"),c(this).attr("href","#")})}var n={};function s(a,n,s,o,t,e,p,r,m){c.post(a+"/plagiarism/compilatio/ajax/display_document_frame.php",{cantriggeranalysis:n,isstudentanalyse:s,cmpfileid:o,canviewreport:t,isteacher:e,url:p,filename:r},function(n){c("#cmp-"+m).empty().append(n),setTimeout(n=>{if(e){var s=c("#cmp-"+m+" .cmp-similarity");s.on("mouseover",c=>{s.find("i").removeClass("fa-circle").addClass("fa-refresh")}),s.on("mouseout",c=>{s.find("i").removeClass("fa-refresh").addClass("fa-circle")}),s.click(function(){s.empty(),c("#cmp-score-icons").remove(),c.post(a+"/plagiarism/compilatio/ajax/update_score.php",{docId:o},function(c){s.replaceWith(c)})})}var t=c("#cmp-"+m+" .cmp-library");t.click(function(){if((i=t.find("i")).is(".cmp-library-in"))var n=0;if(i.is(".cmp-library-out"))var n=1;i.removeClass(),c.post(a+"/plagiarism/compilatio/ajax/set_indexing_state.php",{docId:o,indexingState:n},function(c){"true"==c&&(0==n?i.addClass("cmp-library-out fa-times-circle fa"):i.addClass("cmp-library-in fa-check-circle fa"))})});var p=c("#cmp-"+m+" .cmp-start-btn");p.click(function(){p.find("i").removeClass("fa-play-circle").addClass("fa-spinner fa-spin"),c.post(a+"/plagiarism/compilatio/ajax/start_analysis.php",{docId:o},function(a){"error"in(a=JSON.parse(a))?(c("#cmp-"+m+" p").remove(),c("#cmp-"+m).append("<p class='cmp-color-red'>"+a.error+"</p>"),p.find("i").removeClass("fa-spinner fa-spin").addClass("fa-play-circle")):p.replaceWith(a.documentFrame)})})},500)})}return n.startAllAnalysis=function(n,s,o){c(document).ready(function(){c("#cmp-start-btn").click(function(){a(),c("#cmp-notices").append("<div class='cmp-alert cmp-alert-info'>"+o+"<i class='ml-3 fa fa-lg fa-spinner fa-spin'></i></div>"),c.post(n+"/plagiarism/compilatio/ajax/start_all_analysis.php",{cmid:s},function(){window.location.reload()})})})},n.sendUnsentDocs=function(n,s,o){c(document).ready(function(){c("#cmp-send-btn").click(function(){a(),c("#cmp-notices").append("<div class='cmp-alert cmp-alert-info'>"+o+"<i class='ml-3 fa fa-lg fa-spinner fa-spin'></i></div>"),c.post(n+"/plagiarism/compilatio/ajax/send_unsent_docs.php",{cmid:s},function(){window.location.reload()})})})},n.resetDocsInError=function(n,s,o){c(document).ready(function(){c("#cmp-reset-btn").click(function(){a(),c("#cmp-notices").append("<div class='cmp-alert cmp-alert-info'>"+o+"<i class='ml-3 fa fa-lg fa-spinner fa-spin'></i></div>"),c.post(n+"/plagiarism/compilatio/ajax/reset_docs_in_error.php",{cmid:s},function(){window.location.reload()})})})},n.validateTermsOfService=function(a,n){c(document).ready(function(){c("#tos-btn").click(function(){c.post(a+"/plagiarism/compilatio/ajax/validate_terms_of_service.php",{userid:n},function(){window.location.reload()})})})},n.checkUserInfo=function(a,n){c(document).ready(function(){c.post(a+"/plagiarism/compilatio/ajax/check_user_info.php",{userid:n})})},n.displayDocumentFrame=function(a,n,o,t,e,p,r,m,l){c(document).ready(function(){s(a,n,o,t,e,p,r,m,l),setInterval(function(){s(a,n,o,t,e,p,r,m,l)},18e4)})},n.compilatioTabs=function(a,n){c(document).ready(function(){c(".moove.secondary-navigation")[0]&&(c("#cmp-container").css("margin-top","140px"),c("#cmp-display-frame").css("margin-top","140px")),c(".cmp-md").each(function(){c(this).html(markdown(c.trim(c(this).text())))}),0==localStorage.getItem("cmp-container-displayed")&&(c("#cmp-container").hide(),c("#cmp-display-frame").show()),a>0&&c("#cmp-bell").show(),c("#cmp-display-frame").on("click",function(){localStorage.setItem("cmp-container-displayed",1),c(this).hide(),c("#cmp-container").show()}),c("#cmp-hide-frame").on("click",function(){localStorage.setItem("cmp-container-displayed",0),c("#cmp-container").hide(),c("#cmp-display-frame").show()}),c("#cmp-tabs").show(),c("#cmp-notices > .cmp-alert > .fa-times").on("click",function(){c("#cmp-notices").empty()});var s="";c(s=n?"#cmp-search":"#cmp-home").show(),c("#cmp-show-notifications").on("click",function(){e(c(this),c("#cmp-notifications"))}),c("#show-stats").on("click",function(){e(c(this),c("#cmp-stats"))}),c("#show-help").on("click",function(){e(c(this),c("#cmp-help"))}),c("#show-search").on("click",function(){e(c(this),c("#cmp-search"))});var o=c("#cmp-show-notifications, #show-stats, #show-help, #show-search"),t=c("#cmp-notifications, #cmp-stats, #cmp-help, #cmp-home, #cmp-search");function e(a,n){n.is(":visible")||(n.show(),t.not(n).hide(),o.not(a).removeClass("active"),a.toggleClass("active")),c("#cmp-stats").hasClass("active")&&c("#cmp-container").css("max-width","none")}c("#cmp-logo").on("click",function(){var a=c("#cmp-home");a.show(),t.not(a).hide(),o.removeClass("active")})})},n});