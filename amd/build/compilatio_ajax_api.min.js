define(["jquery"],function(t){function n(){t(".cmp-action-btn").each(function(){t(this).attr("disabled","disabled"),t(this).addClass("disabled"),t(this).attr("href","#")})}var c={};function o(c,o,a,s){n(),t("#cmp-alerts").append("<div class='cmp-alert cmp-alert-info'>"+c+"<i class='ml-3 fa fa-lg fa-spinner fa-spin'></i></div>"),t.post(o+"/plagiarism/compilatio/ajax/start_all_analysis.php",{cmid:a,selectedUsers:null!=s?s.toString():""},function(){window.location.reload()})}function a(n,c,o,a,s,e,p,r){t.post(n+"/plagiarism/compilatio/ajax/display_document_frame.php",{cantriggeranalysis:c,isstudentanalyse:o,cmpfileid:a,canviewreport:s,isteacher:e,url:p},function(c){t("#cmp-"+r).empty().append(c),setTimeout(c=>{if(e){var o=t("#cmp-"+r+" .cmp-similarity");o.on("mouseover",t=>{o.find("i").show(),o.find("span").hide()}),o.on("mouseout",t=>{o.find("i").hide(),o.find("span").show()}),o.click(function(){t("#cmp-"+r+" #cmp-score-icons").remove(),o.empty(),t.post(n+"/plagiarism/compilatio/ajax/update_score.php",{docId:a},function(t){o.replaceWith(t)})})}var s=t("#cmp-"+r+" .cmp-library");s.click(function(){if((i=s.find("i")).is(".cmp-library-in"))var c=0;if(i.is(".cmp-library-out"))var c=1;i.removeClass(),t.post(n+"/plagiarism/compilatio/ajax/set_indexing_state.php",{docId:a,indexingState:c},function(t){"true"==t&&(0==c?i.addClass("cmp-library-out fa-times-circle fa"):i.addClass("cmp-library-in fa-check-circle fa"))})});var p=t("#cmp-"+r+" .cmp-start-btn");p.click(function(){p.find("i").removeClass("fa-play-circle").addClass("fa-spinner fa-spin"),t.post(n+"/plagiarism/compilatio/ajax/start_analysis.php",{docId:a},function(n){"error"in(n=JSON.parse(n))?(t("#cmp-"+r+" p").remove(),t("#cmp-"+r).append("<p class='cmp-color-red'>"+n.error+"</p>"),p.find("i").removeClass("fa-spinner fa-spin").addClass("fa-play-circle")):p.replaceWith(n.documentFrame)})})},500)})}return c.getSelectedStudent=function(n,c){t(document).ready(function(){let o=t("#student-select"),a=t("#statistics-container");function s(t,n){var c=t+n;let a=o.find("option").length-1;-1==c?c=a:c>a&&(c=0),o.prop("selectedIndex",c).change()}o.on("change",function(){let o=t(this).val();t.ajax({type:"POST",url:n+"/plagiarism/compilatio/ajax/stats_per_student.php",data:{selectedstudent:o,cmid:c},success:function(t){a.html(t)},error:function(t){console.error("Error:",t)}})}),t("#previous-student").on("click",function(){s(o.prop("selectedIndex"),-1)}),t("#next-student").on("click",function(){s(o.prop("selectedIndex"),1)})})},c.startAllAnalysis=function(n,c,a){t(document).ready(function(){t(".cmp-start-btn").click(function(){o(a,n,c,null)})})},c.startAnalysesOnSelectedFiles=function(n,c,a){t(document).ready(function(){let s=t("#show-multiple-analyse-options").hide(),e=t("td.c0 input, #selectall");function p(){return e.filter(":checked").map(function(){return"on"!=t(this).val()?t(this).val():null}).get()}e.on("change",function t(){let n=p();n.length>0?s.show():s.hide()}),s.click(function(){o(a,n,c,p())})})},c.sendUnsentDocs=function(c,o,a){t(document).ready(function(){t("#cmp-send-btn").click(function(){n(),t("#cmp-alerts").append("<div class='cmp-alert cmp-alert-info'>"+a+"<i class='ml-3 fa fa-lg fa-spinner fa-spin'></i></div>"),t.post(c+"/plagiarism/compilatio/ajax/send_unsent_docs.php",{cmid:o},function(){window.location.reload()})})})},c.resetDocsInError=function(c,o,a){t(document).ready(function(){t("#cmp-reset-btn").click(function(){n(),t("#cmp-alerts").append("<div class='cmp-alert cmp-alert-info'>"+a+"<i class='ml-3 fa fa-lg fa-spinner fa-spin'></i></div>"),t.post(c+"/plagiarism/compilatio/ajax/reset_docs_in_error.php",{cmid:o},function(){window.location.reload()})})})},c.validateTermsOfService=function(n,c){t(document).ready(function(){t("#tos-btn").click(function(){t.post(n+"/plagiarism/compilatio/ajax/validate_terms_of_service.php",{userid:c},function(){window.location.reload()})})})},c.checkUserInfo=function(n,c){t(document).ready(function(){t.post(n+"/plagiarism/compilatio/ajax/check_user_info.php",{userid:c})})},c.displayDocumentFrame=function(n,c,o,s,e,p,r,l){t(document).ready(function(){a(n,c,o,s,e,p,r,l),setInterval(function(){a(n,c,o,s,e,p,r,l)},18e4)})},c.getNotifications=function(n,c){t(document).ready(function(){t.post(n+"/plagiarism/compilatio/ajax/get_notifications.php",{userid:c,read:JSON.parse(localStorage.getItem("notifications-read"))??[],ignored:JSON.parse(localStorage.getItem("notifications-ignored"))??[]},function(n){function c(){t(".cmp-alert-notifications").remove(),localStorage.setItem("notifications-ignored",JSON.stringify(n.ids))}n=JSON.parse(n),t("#cmp-count-notifications").html(0==n.count?"":n.count),t("#cmp-notifications").html(n.content),t("#cmp-alerts").append(n.floating),t(".cmp-notifications-title").on("click",function(){let n=t("#cmp-count-notifications").html();n--,t("#cmp-count-notifications").html(n<=0?"":n),c(),t("#cmp-show-notifications").toggleClass("active"),t("#cmp-notifications").show(),t("#cmp-notifications-titles").hide();let o=t(this).attr("id").split("-").pop();t("#cmp-notifications-content-"+o).show(),t("#cmp-notifications-"+o).children().first().removeClass("text-primary");let a=JSON.parse(localStorage.getItem("notifications-read"))??[];a.includes(o)||(a.push(o),localStorage.setItem("notifications-read",JSON.stringify(a)))}),t(".cmp-show-notifications").on("click",function(){t("#cmp-notifications-titles").show(),t(".cmp-notifications-content").hide()}),t("#cmp-ignore-notifications").on("click",function(){c()}),t("#cmp-show-notifications").on("click",function(){c()})})})},c.compilatioTabs=function(n){t(document).ready(function(){t(".moove.secondary-navigation")[0]&&t("#cmp-container").css("margin-top","140px"),t(".cmp-md").each(function(){t(this).html(markdown(t.trim(t(this).text())))}),t("#cmp-tabs").show(),t("#cmp-alerts > .cmp-alert > .fa-times").on("click",function(){t("#cmp-alert-"+t(this).attr("id").split("-").pop()).parent().remove()}),n&&t("#cmp-search").show(),t("#cmp-show-notifications").on("click",function(){a(t(this),t("#cmp-notifications"))}),t("#show-stats").on("click",function(){a(t(this),t("#cmp-stats"))}),t("#show-stats-per-student").on("click",function(){a(t(this),t("#cmp-stats-per-student"))}),t("#show-help").on("click",function(){a(t(this),t("#cmp-help"))}),t("#show-search").on("click",function(){a(t(this),t("#cmp-search"))});var c=t("#cmp-show-notifications, #show-stats, #show-stats-per-student, #show-help, #show-search"),o=t("#cmp-notifications, #cmp-stats, #cmp-stats-per-student, #cmp-help, #cmp-search");function a(n,a){a.is(":visible")?(o.hide(),c.removeClass("active")):(a.show(),o.not(a).hide(),c.not(n).removeClass("active"),n.toggleClass("active")),t("#show-stats").hasClass("active")&&t("#cmp-container").css("max-width","none")}t("#cmp-logo").on("click",function(){o.hide(),c.removeClass("active")})})},c});