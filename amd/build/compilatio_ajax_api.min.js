define(["jquery"],function(i){function t(){i(".cmp-action-btn").each(function(){i(this).attr("disabled","disabled"),i(this).addClass("disabled"),i(this).attr("href","#")})}var n={};function c(n,c,s,o){t(),i("#cmp-alerts").append("<div class='cmp-alert cmp-alert-info'>"+n+"<i class='ml-3 fa fa-lg fa-spinner fa-spin'></i></div>"),i.post(c+"/plagiarism/compilatio/ajax/start_all_analysis.php",{cmid:s,selectedUsers:null!=o?o.toString():""},function(){window.location.reload()})}function s(t,n,c,s,o,a,e,r){i.post(t+"/plagiarism/compilatio/ajax/display_document_frame.php",{cantriggeranalysis:n,isstudentanalyse:c,cmpfileid:s,canviewreport:o,isteacher:a,url:e},function(n){i("#cmp-"+r).empty().append(n),setTimeout(n=>{if(a){var c=i("#cmp-"+r+" .cmp-similarity");c.on("mouseover",i=>{c.find("i").show(),c.find("span").hide()}),c.on("mouseout",i=>{c.find("i").hide(),c.find("span").show()}),c.click(function(){i("#cmp-"+r+" #cmp-score-icons").remove(),c.empty(),i.post(t+"/plagiarism/compilatio/ajax/update_score.php",{docId:s},function(i){c.replaceWith(i)})})}i("#cmp-"+r+" .cmp-library").click(function(){var n=i(this).find("i");if(n.is(".cmp-library-in"))var c=0;if(n.is(".cmp-library-out"))var c=1;n.removeClass(),i.post(t+"/plagiarism/compilatio/ajax/set_indexing_state.php",{docId:s,indexingState:c},function(i){"true"==i&&(0==c?n.addClass("cmp-library-out fa-times-circle fa"):n.addClass("cmp-library-in fa-check-circle fa"))})});var o=i("#cmp-"+r+" .cmp-start-btn");o.click(function(){o.find("i").removeClass("fa-play-circle").addClass("fa-spinner fa-spin"),i.post(t+"/plagiarism/compilatio/ajax/start_analysis.php",{docId:s},function(t){"error"in(t=JSON.parse(t))?(i("#cmp-"+r+" p").remove(),i("#cmp-"+r).append("<p class='cmp-color-red'>"+t.error+"</p>"),o.find("i").removeClass("fa-spinner fa-spin").addClass("fa-play-circle")):o.replaceWith(t.documentFrame)})})},500)})}return n.getSelectedStudent=function(t,n){i(document).ready(function(){let c=i("#student-select"),s=i("#statistics-container");function o(i,t){var n=i+t;let s=c.find("option").length-1;-1==n?n=s:n>s&&(n=0),c.prop("selectedIndex",n).change()}c.on("change",function(){let c=i(this).val();i.ajax({type:"POST",url:t+"/plagiarism/compilatio/ajax/stats_per_student.php",data:{selectedstudent:c,cmid:n},success:function(i){s.html(i)},error:function(i){console.error("Error:",i)}})}),i("#previous-student").on("click",function(){o(c.prop("selectedIndex"),-1)}),i("#next-student").on("click",function(){o(c.prop("selectedIndex"),1)})})},n.startAllAnalysis=function(t,n,s){i(document).ready(function(){i(".cmp-start-btn").click(function(){c(s,t,n,null)})})},n.startAnalysesOnSelectedFiles=function(t,n,s){i(document).ready(function(){let o=i("#start-selected-analyses-btn").hide(),a=i("td.c0 input, #selectall");function e(){return a.filter(":checked").map(function(){return"on"!=i(this).val()?i(this).val():null}).get()}a.on("change",function i(){let t=e();t.length>0?o.show():o.hide()}),o.click(function(){c(s,t,n,e())})})},n.sendUnsentDocs=function(n,c,s){i(document).ready(function(){i("#cmp-send-btn").click(function(){t(),i("#cmp-alerts").append("<div class='cmp-alert cmp-alert-info'>"+s+"<i class='ml-3 fa fa-lg fa-spinner fa-spin'></i></div>"),i.post(n+"/plagiarism/compilatio/ajax/send_unsent_docs.php",{cmid:c},function(){window.location.reload()})})})},n.resetDocsInError=function(n,c,s){i(document).ready(function(){i("#cmp-reset-btn").click(function(){t(),i("#cmp-alerts").append("<div class='cmp-alert cmp-alert-info'>"+s+"<i class='ml-3 fa fa-lg fa-spinner fa-spin'></i></div>"),i.post(n+"/plagiarism/compilatio/ajax/reset_docs_in_error.php",{cmid:c},function(){window.location.reload()})})})},n.analysescoressettings=function(t,n,c){i(document).ready(function(){var s=i("#score-settings-ignored");s.click(function(){s.css("background-color","grey"),s.html('<div class="spinner-border spinner-border-sm" role="status"><span class="sr-only">Loading...</span></div>'),i("#loading-blur").css("filter","blur(2px)");var o=i(".checkbox-score-settings:checked"),a=[];o.each(function(){a.push(i(this).val())}),i.ajax({type:"POST",url:t+"/plagiarism/compilatio/ajax/update_score_settings.php",data:{cmid:n,checkedvalues:a,scores:c},success:function(){window.location.reload()},error:function(i){console.error("Error:",i)}})})})},n.validateTermsOfService=function(t,n){i(document).ready(function(){i("#tos-btn").click(function(){i.post(t+"/plagiarism/compilatio/ajax/validate_terms_of_service.php",{userid:n},function(){window.location.reload()})})})},n.checkUserInfo=function(t,n){i(document).ready(function(){i.post(t+"/plagiarism/compilatio/ajax/check_user_info.php",{userid:n})})},n.displayDocumentFrame=function(t,n,c,o,a,e,r,p){i(document).ready(function(){s(t,n,c,o,a,e,r,p),setInterval(function(){s(t,n,c,o,a,e,r,p)},18e4)})},n.getNotifications=function(t,n){i(document).ready(function(){i.post(t+"/plagiarism/compilatio/ajax/get_notifications.php",{userid:n,read:JSON.parse(localStorage.getItem("notifications-read"))??[],ignored:JSON.parse(localStorage.getItem("notifications-ignored"))??[]},function(t){function n(){i(".cmp-alert-notifications").remove(),localStorage.setItem("notifications-ignored",JSON.stringify(t.ids))}t=JSON.parse(t),i("#cmp-count-notifications").html(0==t.count?"":t.count),i("#cmp-notifications").html(t.content),i("#cmp-alerts").append(t.floating),i(".cmp-notifications-title").on("click",function(){let t=i("#cmp-count-notifications").html();t--,i("#cmp-count-notifications").html(t<=0?"":t),n(),i("#cmp-show-notifications").toggleClass("active"),i("#cmp-notifications").show(),i("#cmp-notifications-titles").hide();let c=i(this).attr("id").split("-").pop();i("#cmp-notifications-content-"+c).show(),i("#cmp-notifications-"+c).children().first().removeClass("text-primary");let s=JSON.parse(localStorage.getItem("notifications-read"))??[];s.includes(c)||(s.push(c),localStorage.setItem("notifications-read",JSON.stringify(s)))}),i(".cmp-show-notifications").on("click",function(){i("#cmp-notifications-titles").show(),i(".cmp-notifications-content").hide()}),i("#cmp-ignore-notifications").on("click",function(){n()}),i("#cmp-show-notifications").on("click",function(){n()})})})},n.compilatioTabs=function(t){i(document).ready(function(){i(".moove.secondary-navigation")[0]&&i("#cmp-container").css("margin-top","140px"),i(".cmp-md").each(function(){i(this).html(markdown(i.trim(i(this).text())))}),i("#cmp-tabs").show(),i("#cmp-alerts > .cmp-alert > .fa-times").on("click",function(){i("#cmp-alert-"+i(this).attr("id").split("-").pop()).parent().remove()}),t&&i("#cmp-search").show(),i("#cmp-show-notifications").on("click",function(){s(i(this),i("#cmp-notifications"))}),i("#show-stats").on("click",function(){s(i(this),i("#cmp-stats"))}),i("#show-stats-per-student").on("click",function(){s(i(this),i("#cmp-stats-per-student"))}),i("#show-help").on("click",function(){s(i(this),i("#cmp-help"))}),i("#show-search").on("click",function(){s(i(this),i("#cmp-search"))}),i("#cmp-show-settings").on("click",function(){s(i(this),i("#cmp-settings"))});var n=i("#cmp-show-notifications, #show-stats, #show-stats-per-student, #show-help, #show-search, #cmp-show-settings"),c=i("#cmp-notifications, #cmp-stats, #cmp-stats-per-student, #cmp-help, #cmp-search, #cmp-settings");function s(t,s){s.is(":visible")?(c.hide(),n.removeClass("active")):(s.show(),c.not(s).hide(),n.not(t).removeClass("active"),t.toggleClass("active")),i("#show-stats").hasClass("active")&&i("#cmp-container").css("max-width","none")}i("#cmp-logo").on("click",function(){c.hide(),n.removeClass("active")})})},n});